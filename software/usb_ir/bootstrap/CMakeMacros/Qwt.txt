# get the great-grandparent directory of moc.exe to construct Qwt paths
If(QT_MOC_EXECUTABLE)
  get_filename_component(PARENT_DIR ${QT_MOC_EXECUTABLE} PATH)
  get_filename_component(PARENT_DIR ${PARENT_DIR} PATH)
  # TODO: cmake 2.8.12 supports a better way?  TODO: just do a regex
  # get_filename_component(PARENT_DIR ${MYPROJECT_DIR} DIRECTORY)
  get_filename_component(PARENT_DIR ${PARENT_DIR} PATH)
  Set(QWT_INCLUDE_DIR "${PARENT_DIR}/qwt-6.1.0/src")
  find_package(Qwt QUIET)
EndIf()

Set(Qwt_FOUND FALSE)
If ("${QWT_VERSION_STRING}" STREQUAL "")
    message(STATUS "Qwt not found")
Else()
  If ("${CMAKE_GENERATOR}" STREQUAL "Visual Studio 10")
    message(STATUS "Copying Qwt dlls into ${CMAKE_CONFIGURATION_TYPES} folders")
    ForEach(platform ${CMAKE_CONFIGURATION_TYPES})
      Set(LIBFILE "${QWT_LIBRARY}")
      If ("${platform}" STREQUAL "Debug")
        Set(LIBFILE "${QWT_DEBUG_LIBRARY}")
      EndIf()

      get_filename_component(LIBPATH ${LIBFILE} PATH)
      get_filename_component(LIBFILE ${LIBFILE} NAME_WE)
      Execute_Process(COMMAND ${CMAKE_COMMAND} -E copy_if_different "${LIBPATH}/${LIBFILE}.dll" "${CMAKE_SOURCE_DIR}/${platform}/${LIBFILE}.dll")
    EndForEach()
  EndIf()
  Set(Qwt_FOUND TRUE)
EndIf()
